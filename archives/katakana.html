<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Kagami Nihongo Post Generator</title>
    <!-- Tabler Core CSS -->
    <link rel="stylesheet" href="https://unpkg.com/@tabler/core@latest/dist/css/tabler.min.css">
    <!-- Tom Select CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tom-select@2.4.3/dist/css/tom-select.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --brand-color: #FF4081;
            --brand-light: #ff80ab;
            --brand-dark: #c60055;
            --brand-bg: #fff5f9;
            --brand-header: #ffe5ef; /* light pink header */
            /* Map Tabler variables to brand */
            --tblr-primary: var(--brand-color);
            --tblr-primary-rgb: 255, 64, 129;
            --tblr-link-color: var(--brand-color);
            --tblr-link-hover-color: var(--brand-dark);
            --tblr-btn-active-bg: var(--brand-dark);
            --tblr-btn-active-border-color: var(--brand-dark);
        }
        
        body {
            background-color: var(--brand-bg);
            background-image: url("data:image/svg+xml,%3Csvg width='84' height='48' viewBox='0 0 84 48' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30 16.2c-2.5 0-4.7 2-4.7 4.7s2 4.7 4.7 4.7 4.7-2 4.7-4.7-2.1-4.7-4.7-4.7zm0 1.4c1.8 0 3.3 1.5 3.3 3.3s-1.5 3.3-3.3 3.3-3.3-1.5-3.3-3.3 1.5-3.3 3.3-3.3zm15-8.1c-2.6 0-4.7 2.1-4.7 4.7s2.1 4.7 4.7 4.7 4.7-2.1 4.7-4.7-2.1-4.7-4.7-4.7zm0 1.4c1.8 0 3.3 1.5 3.3 3.3s-1.5 3.3-3.3 3.3-3.3-1.5-3.3-3.3 1.5-3.3 3.3-3.3z' fill='%23ffd6e7' fill-opacity='0.3' fill-rule='evenodd'/%3E%3C/svg%3E");
        }
        .card {
            border: none;
            box-shadow: 0 1px 2px 0 rgba(255, 64, 129, 0.1);
            margin-bottom: 1.5rem;
            border: 1px solid rgba(255, 64, 129, 0.1);
        }
        .card-header {
            background-color: var(--brand-header);
            border-bottom: 1px solid rgba(255, 64, 129, 0.15);
            font-weight: 600;
            color: var(--brand-dark);
        }
        .preview-output {
            min-height: 400px;
            background-color: #1a1a1a;
            color: #e0e0e0;
            border: none;
            padding: 1.5rem;
            white-space: pre-wrap;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            font-size: 0.95rem;
            line-height: 1.7;
            overflow-y: auto;
            width: 100%;
            height: 100%;
        }
        .btn-primary {
            background-color: var(--brand-color);
            border-color: var(--brand-color);
        }
        .btn-primary:hover {
            background-color: var(--brand-dark);
            border-color: var(--brand-dark);
        }
        
        .ts-control {
            border: 1px solid rgba(255, 64, 129, 0.3);
            padding: 0.375rem 0.75rem;
            min-height: 42px;
        }
        
        /* Add this new rule for the word types selector */
        #word-types {
            min-height: 60px; /* Approximately 2 lines of text */
        }
        
        .form-control:focus, .form-select:focus, .ts-control.focus {
            border-color: var(--brand-light);
            box-shadow: 0 0 0 0.25rem rgba(255, 64, 129, 0.25);
        }
        .ts-wrapper.multi .ts-control > div {
            background-color: var(--brand-light);
            color: #fff;
            border-radius: 4px;
            padding: 0.25rem 0.5rem;
            margin: 2px;
        }
    </style>
</head>

<body class="d-flex flex-column">
    <header class="navbar navbar-expand-md navbar-light d-print-none sticky-top" style="background-color: #fff; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);">
        <div class="container-xl">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar-menu">
                <span class="navbar-toggler-icon"></span>
            </button>
            <h1 class="navbar-brand navbar-brand-autodark d-none-navbar-horizontal pe-0 pe-md-3">
                <span class="text-primary">Kagami Nihongo</span> Post Generator
            </h1>
            
            <div class="collapse navbar-collapse" id="navbar-menu">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/">
                            <i class="fas fa-home me-1"></i> Home
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" data-bs-auto-close="outside" role="button" aria-expanded="false">
                            <i class="fas fa-book me-1"></i> Vocabulary
                        </a>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" href="/nihongo">Word List</a>
                            <a class="dropdown-item" href="#">Add New Word</a>
                            <a class="dropdown-item" href="#">Practice</a>
                        </div>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/nihongo/katakana.html">
                            <i class="fas fa-font me-1"></i> Katakana
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <i class="fas fa-file-alt me-1"></i> Grammar
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <i class="fas fa-comment-alt me-1"></i> Practice
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <i class="fas fa-chart-bar me-1"></i> Progress
                        </a>
                    </li>
                </ul>
            </div>

            <div class="navbar-nav flex-row order-md-last">
                <div class="nav-item">
                    <button class="btn btn-primary" id="copyButtonTop">
                        <i class="fas fa-copy me-2"></i>Copy to Clipboard
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="page-wrapper" style="flex: 1 0 auto;">
        <div class="container-xl py-4">
            <div class="row g-4">
                <!-- Column 1 -->
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Basic Information</h3>
                            <div class="card-actions">
                                <a href="https://jisho.org" target="_blank" class="btn btn-ghost-secondary btn-sm" title="Markdown Guide">
                                    <i class="fas fa-book-atlas me-2"></i>
                                    Jisho
                                </a>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row g-3 mb-3">
                                <div class="col-md-4">
                                    <label class="form-label" for="japanese-text">Japanese Text</label>
                                    <input type="text" class="form-control" id="japanese-text">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label" for="origin-text">Origin</label>
                                    <input type="text" class="form-control" id="origin-text">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label" for="thai-text">Thai Translation</label>
                                    <input type="text" class="form-control" id="thai-text">
                                </div>
                                <div class="mb-0">
                                    <label class="form-label" for="gametitle">Game Title</label>
                                    <input type="text" class="form-control" id="gametitle">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Moved from former Column 2: Word Properties -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Word Properties</h3>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label" for="word-types">Word Types</label>
                                        <select id="word-types" multiple>
                                            <option value="คำนาม">คำนาม</option>
                                            <option value="คำคุณศัพท์ な">คำคุณศัพท์ な</option>
                                            <option value="คำคุณศัพท์ い">คำคุณศัพท์ い</option>
                                            <option value="คำกริยากลุ่ม 1">คำกริยากลุ่ม 1</option>
                                            <option value="คำกริยากลุ่ม 2">คำกริยากลุ่ม 2</option>
                                            <option value="คำกริยากลุ่ม 3 (する)">คำกริยากลุ่ม 3 (する)</option>
                                            <option value="สกรรมกริยา (他動詞)">สกรรมกริยา (他動詞)</option>
                                            <option value="อกรรมกริยา (自動詞)">อกรรมกริยา (自動詞)</option>
                                            <option value="คำวิเศษณ์">คำวิเศษณ์</option>
                                            <option value="คำขยายคำหลัก (連体詞)">คำขยายคำหลัก (連体詞)</option>
                                        </select>
                                    </div>

                                    <div class="mb-0">
                                        <label class="form-label" for="n-level">JLPT Level</label>
                                        <select class="form-select" id="n-level">
                                            <option value="None">None</option>
                                            <option value="N1">N1</option>
                                            <option value="N2">N2</option>
                                            <option value="N3">N3</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="jlpt-exam">
                                            <label class="form-check-label" for="jlpt-exam">Appears in JLPT</label>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label" for="jlpt-level">JLPT Level</label>
                                        <select class="form-select" id="jlpt-level" disabled>
                                            <option value="N1">N1</option>
                                            <option value="N2">N2</option>
                                            <option value="N3">N3</option>
                                        </select>
                                    </div>

                                    <div class="row g-2 mb-0">
                                        <div class="col-6">
                                            <label class="form-label" for="year">Year</label>
                                            <input type="text" class="form-control" id="year" placeholder="Year" disabled>
                                        </div>
                                        <div class="col-6">
                                            <label class="form-label" for="month">Month</label>
                                            <select class="form-select" id="month" disabled>
                                                <option value="07">07</option>
                                                <option value="12">12</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="jtest-exam">
                                            <label class="form-check-label" for="jtest-exam">Appears in J.TEST</label>
                                        </div>
                                    </div>

                                    <div class="mb-0">
                                        <label class="form-label" for="jtest-no">J.TEST Number</label>
                                        <input type="text" class="form-control" id="jtest-no" placeholder="Enter test number" disabled>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- New Content block -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Description</h3>
                        </div>
                        <div class="card-body p-0">
                                <textarea 
                                    id="description" 
                                    class="form-control border-0" 
                                    placeholder="Enter description"
                                    style="min-height: 400px; resize: true;"
                                    spellcheck="false"
                                ></textarea>
                        </div>
                    </div>
                </div>

                <!-- Column 2 (Preview) -->
                <div class="col-md-4">
                    <div class="sticky-top" style="top: 5rem; margin-bottom: 2rem;">
                    <div class="card h-100">
                        <div class="card-header">
                            <h3 class="card-title">Preview</h3>
                            <div class="card-actions">
                                <button class="btn btn-ghost-secondary btn-sm" id="exampleButton"><i class="fas fa-lightbulb me-2"></i>Example</button>
                            </div>
                        </div>
                        <div class="card-body p-0 d-flex flex-column">
                            <div class="preview-output flex-grow-1" id="preview"></div>
                        </div>
                        <div class="card-footer">
                            <div class="d-flex justify-content-between align-items-center">
                                <button id="clearAllBtn" class="btn btn-outline-danger">
                                    <i class="fas fa-trash-alt me-2"></i>Clear All
                                </button>
                                <button class="btn btn-primary" id="copyButtonBottom">
                                    <i class="fas fa-copy me-2"></i>Copy to Clipboard
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </div>
        </div>
    </div>

    <footer class="footer footer-transparent d-print-none">
        <div class="container-xl">
            <div class="row text-center align-items-center flex-row-reverse">
                <div class="col-12 col-lg-auto mt-3 mt-lg-0">
                    <ul class="list-inline list-inline-dots mb-0">
                        <li class="list-inline-item">
                            Copyright 2025
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <!-- Tabler Core JS -->
    <script src="https://unpkg.com/@tabler/core@latest/dist/js/tabler.min.js"></script>
    <!-- Tom Select JS -->
    <script src="https://cdn.jsdelivr.net/npm/tom-select@2.4.3/dist/js/tom-select.complete.min.js"></script>

    <!-- Original script -->
    <script>
        // Initialize Tom Select
        const wordTypesSelect = new TomSelect('#word-types', {
            plugins: ['remove_button','clear_button'],
            maxItems: null,
            persist: false,
            create: false,
            onChange: function() {
                updatePreview();
            }
        });

        const japaneseTextInput = document.getElementById('japanese-text');
        const originTextInput = document.getElementById('origin-text');
        const thaiTextInput = document.getElementById('thai-text');
        const descriptionInput = document.getElementById('description');
        const gameTitleInput = document.getElementById('gametitle');
        const previewOutput = document.getElementById('preview');
        // Get both copy buttons
        const copyButtonTop = document.getElementById('copyButtonTop');
        const copyButtonBottom = document.getElementById('copyButtonBottom');
        const nLevelSelect = document.getElementById('n-level');
        const jlptLevelSelect = document.getElementById('jlpt-level');
        const yearInput = document.getElementById('year');
        const monthInput = document.getElementById('month');
        const jlptExamCheckbox = document.getElementById('jlpt-exam');
        const jtestExamCheckbox = document.getElementById('jtest-exam');
        const jtestNoInput = document.getElementById('jtest-no');
        const exampleButton = document.getElementById('exampleButton');

        // Initialize jtest-no input as disabled
        jtestNoInput.disabled = true;

        // Add N-level dependency logic
        nLevelSelect.addEventListener('change', function() {
            const selectedValue = this.value;
            if (selectedValue !== 'None') {
                // Only update JLPT level if checkbox is checked
                if (jlptExamCheckbox.checked) {
                    jlptLevelSelect.value = selectedValue;
                    yearInput.value = new Date().getFullYear();
                    monthInput.value = new Date().getMonth() + 1;
                }
            }
            updatePreview();
        });

        // Add JLPT exam checkbox dependency logic
        jlptExamCheckbox.addEventListener('change', function() {
            jlptLevelSelect.disabled = !this.checked;
            yearInput.disabled = !this.checked;
            monthInput.disabled = !this.checked;
            if (this.checked) {
                // When checkbox is checked, set JLPT level to match N-level if one is selected
                const nLevelValue = nLevelSelect.value;
                if (nLevelValue !== 'None') {
                    jlptLevelSelect.value = nLevelValue;
                    yearInput.value = new Date().getFullYear();
                    monthInput.value = new Date().getMonth() + 1;
                }
            }
            updatePreview();
        });

        // Add JTest exam checkbox dependency logic
        jtestExamCheckbox.addEventListener('change', function() {
            jtestNoInput.disabled = !this.checked; // Enable/disable jtestNoInput
            updatePreview();
        });

        function updatePreview() {
            let japaneseText = japaneseTextInput.value;
            let originText = originTextInput.value;
            let thaiText = thaiTextInput.value;
            let description = descriptionInput.value;
            let gameTitle = gameTitleInput.value;
            let nLevel = nLevelSelect.value;
            let selectedWordTypes = wordTypesSelect.items.map(value => wordTypesSelect.options[value].text).join(' / ');
            let year = yearInput.value;
            let month = monthInput.value;
            let jlptText = "";
            let jtestText = "";

            let output = `【คำศัพท์】\n\n${japaneseText}\n${originText}\n${thaiText}\n\n※ ${selectedWordTypes}`;

            if (nLevel !== "None") {
                output += `\n※ คำศัพท์ JLPT ${nLevel}`;
            }

            if (jlptExamCheckbox.checked) {
                let jlptLevel = jlptLevelSelect.value;
                jlptText = `\n⭐️ ออกสอบ JLPT ${jlptLevel} (รอบ ${year}年${month}月)`;
                output += jlptText;
            }

            if (jtestExamCheckbox.checked) {
                jtestText = `\n⭐️ ออกสอบ J.TEST ระดับ A-C (第${jtestNoInput.value}回)`;
                output += jtestText;
            }

            output += `\n\n————————————\n${description}\n\n————————————\n▍ภาพจากเกม ${gameTitle}`;

            previewOutput.textContent = output;
        }

        // Add event listeners for all inputs
        const textInputs = [
            japaneseTextInput, originTextInput, thaiTextInput,
            descriptionInput, gameTitleInput, jtestNoInput, yearInput, monthInput
        ];
        
        const selectInputs = [nLevelSelect, jlptLevelSelect];
        const checkboxInputs = [jlptExamCheckbox, jtestExamCheckbox];

        // Add input event listeners to text inputs
        textInputs.forEach(input => {
            if (input) input.addEventListener('input', updatePreview);
        });

        // Add change event listeners to select inputs (except Tom Select)
        selectInputs.forEach(select => {
            if (select) select.addEventListener('change', updatePreview);
        });

        // Add change event to Tom Select
        if (wordTypesSelect) {
            wordTypesSelect.on('change', updatePreview);
        }

        // Add change event listeners to checkboxes
        checkboxInputs.forEach(checkbox => {
            if (checkbox) checkbox.addEventListener('change', updatePreview);
        });

        // Custom toast notification system
        function showToast(message, type = 'success') {
            // Create toast container if it doesn't exist
            let toastContainer = document.querySelector('.toast-container');
            if (!toastContainer) {
                toastContainer = document.createElement('div');
                toastContainer.className = 'toast-container position-fixed top-0 end-0 p-3';
                toastContainer.style.zIndex = '1090';
                document.body.appendChild(toastContainer);
            }
            
            const toastId = 'toast-' + Date.now();
            const toast = document.createElement('div');
            toast.id = toastId;
            
            // Use Tabler's alert classes
            const alertClass = type === 'success' ? 'alert-success' : 'alert-danger';
            const iconClass = type === 'success' ? 'fas fa-circle-check' : 'fas fa-exclamation-circle';
            
            toast.className = `alert ${alertClass} alert-dismissible fade show`;
            toast.role = 'alert';
            
            toast.innerHTML = `
                <div class="d-flex align-items-center">
                    <i class="${iconClass} me-2"></i>
                    <div>${message}</div>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            // Auto remove toast after delay
            setTimeout(() => {
                toast.classList.remove('show');
                toast.classList.add('fade');
                setTimeout(() => {
                    toast.remove();
                    if (toastContainer && toastContainer.children.length === 0) {
                        toastContainer.remove();
                    }
                }, 150);
            }, 3000);
            
            // Add close button functionality
            const closeBtn = toast.querySelector('.btn-close');
            if (closeBtn) {
                closeBtn.addEventListener('click', () => {
                    toast.classList.remove('show');
                    toast.classList.add('fade');
                    setTimeout(() => {
                        toast.remove();
                        if (toastContainer && toastContainer.children.length === 0) {
                            toastContainer.remove();
                        }
                    }, 150);
                });
            }
        }

        // Function to handle copy to clipboard
        async function handleCopyToClipboard() {
            const textToCopy = previewOutput.textContent.trim();
            
            if (!textToCopy) {
                showToast('No content to copy!', 'error');
                return;
            }
            
            try {
                // Try the modern clipboard API first
                if (navigator.clipboard) {
                    await navigator.clipboard.writeText(textToCopy);
                } else {
                    // Fallback for older browsers
                    const textarea = document.createElement('textarea');
                    textarea.value = textToCopy;
                    textarea.style.position = 'fixed';  // Prevent scrolling to bottom
                    document.body.appendChild(textarea);
                    textarea.select();
                    
                    try {
                        const successful = document.execCommand('copy');
                        if (!successful) {
                            throw new Error('Copy command was unsuccessful');
                        }
                    } finally {
                        document.body.removeChild(textarea);
                    }
                }
                
                showToast('Copied to clipboard!', 'success');
                
            } catch (err) {
                console.error('Could not copy text: ', err);
                showToast('Failed to copy. Please try again or copy manually.', 'error');
            }
        }
        
        // Add event listeners to both copy buttons
        if (copyButtonTop) copyButtonTop.addEventListener('click', handleCopyToClipboard);
        if (copyButtonBottom) copyButtonBottom.addEventListener('click', handleCopyToClipboard);

        // Clear All button functionality
        const clearAllBtn = document.getElementById('clearAllBtn');
        if (clearAllBtn) {
            clearAllBtn.addEventListener('click', function() {
                // Clear text inputs
                textInputs.forEach(input => {
                    if (input && (input.type === 'text' || input.type === 'textarea')) {
                        input.value = '';
                        // Trigger input event to update preview
                        input.dispatchEvent(new Event('input'));
                    }
                });
                
                // Clear regular select inputs
                selectInputs.forEach(select => {
                    if (select) {
                        select.selectedIndex = 0;
                        select.dispatchEvent(new Event('change'));
                    }
                });
                
                // Clear Tom Select
                if (wordTypesSelect) {
                    wordTypesSelect.clear(true);
                }
                
                // Uncheck checkboxes
                checkboxInputs.forEach(checkbox => {
                    if (checkbox) {
                        checkbox.checked = false;
                        // Trigger change event to update dependent fields
                        checkbox.dispatchEvent(new Event('change'));
                    }
                });
                
                // Update the preview
                updatePreview();
            });
        }

        // Example button handler to set preview text
        if (exampleButton) {
            exampleButton.addEventListener('click', () => {
                const exampleText = `【คำศัพท์คาตาคานะ】

ハプニング
English : happening
เหตุการณ์ไม่คาดฝันที่เกิดขึ้น

※ คำนาม / คำกริยากลุ่ม 3 (する) / อกรรมกริยา (自動詞)
※ คำศัพท์ JLPT N1

————————————
ハプニング (happening) หมายถึง เหตุการณ์ไม่คาดฝัน เรื่องที่ไม่คาดคิด ได้เกิดขึ้น

ความหมายเหมือนกับ 意外な出来事

————————————
▍ภาพจากเกม Meikei no Lupercalia (冥契のルペルカリア)`;
                previewOutput.textContent = exampleText;
            });
        }

        // Initialize the preview
        updatePreview();
    </script>

</body>

</html>