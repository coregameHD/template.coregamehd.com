<%- include('../partials/head', { title: "Kagami Visual Novel Post Generator", cssFile: "visualnovel" }) %>
<body>
    <%- include('../partials/navbar_visualnovel') %>

    <div class="page-wrapper flex-grow-1" style="padding-top: 2rem;">
        <div class="container-xl">
            <div class="row g-4">
                <!-- Snippet Library Column -->
                <div class="col-lg-4 col-xl-3">
                    <div class="card h-100">
                        <div class="card-header">
                            <h3 class="card-title mb-1">Snippet Library</h3>
                        </div>
                        <div class="card-body p-0">
                            <div class="p-3 border-bottom ">
                                <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-3">
                                    <h4 class="fw-semibold">Frequently Used Templates</h4>
                                </div>
                                <div class="d-grid gap-2">
                                    <button class="btn btn-outline-primary btn-sm insert-snippet"
                                        data-snippet="„ÄêNEWS„Äë ‚áí Announcements

{developer} ‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà

{romaji}
{japanese}

üîó Website ‚ãÆ 

‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó 
‚ÑπÔ∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏°
Developer ‚ãÆ 
Release Date ‚ãÆ 
Language ‚ãÆ Japanese
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù 
‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
Source ‚ãÆ ">
                                        ‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà
                                    </button>
                                    <button class="btn btn-outline-primary btn-sm insert-snippet"
                                        data-snippet="„ÄêNEWS„Äë ‚áí Announcements

{localizer} ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏õ‡∏•‡πÄ‡∏Å‡∏°

{romaji}
{japanese}

üîó Steam ‚ãÆ 

‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó 
‚ÑπÔ∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏°
Developer ‚ãÆ 
Publisher ‚ãÆ 
Release Date ‚ãÆ 
Language ‚ãÆ English, Chinese, Japanese
Version ‚ãÆ Censored Edition*
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù 
‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
Source ‚ãÆ ">
                                        ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏õ‡∏•‡πÄ‡∏Å‡∏°
                                    </button>
                                    <button class="btn btn-outline-primary btn-sm insert-snippet"
                                        data-snippet="„ÄêNEWS„Äë ‚áí New Releases

{romaji}
{japanese}
‡∏ß‡∏≤‡∏á‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ

üîó Website ‚ãÆ 

‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó 
‚ÑπÔ∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏°
Developer ‚ãÆ 
Release Date ‚ãÆ 
Language ‚ãÆ Japanese
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ">
                                        ‡πÄ‡∏Å‡∏°‡∏ß‡∏≤‡∏á‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà (‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô)
                                    </button>
                                    <button class="btn btn-outline-primary btn-sm insert-snippet"
                                        data-snippet="„ÄêNEWS„Äë ‚áí New Releases

{romaji}
{japanese}
(‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©: )
‡∏ß‡∏≤‡∏á‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ

üîó Website ‚ãÆ 
üîó Steam ‚ãÆ 

‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó 
‚ÑπÔ∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏°
Developer ‚ãÆ 
Publisher ‚ãÆ 
Release Date ‚ãÆ 
Language ‚ãÆ English, Chinese, Japanese
Version ‚ãÆ Censored Edition*
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù 
‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
* Download Patch ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏ß‡πá‡∏ö ">
                                        ‡πÄ‡∏Å‡∏°‡∏ß‡∏≤‡∏á‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà (Steam)
                                    </button>
                                </div>
                            </div>
                            <div class="list-group list-group-flush">
                                <div class="list-group-item d-flex justify-content-between align-items-start flex-wrap gap-2">
                                    <div>
                                        <div class="fw-semibold">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡πà‡∏≤‡∏ß</div>
                                        <div class="d-flex align-items-center gap-2 mt-2 flex-wrap">
                                            <select id="greetingSelect" class="form-select form-select-sm w-auto">
                                                <option value="„ÄêNEWS„Äë ‚áí Announcements">„ÄêNEWS„Äë ‚áí Announcements</option>
                                                <option value="„ÄêNEWS„Äë ‚áí New Releases">„ÄêNEWS„Äë ‚áí New Releases</option>
                                                <option value="„ÄêNEWS„Äë ‚áí Master Up">„ÄêNEWS„Äë ‚áí Master Up</option>
                                                <option value="„ÄêNEWS„Äë ‚áí Delays">„ÄêNEWS„Äë ‚áí Delays</option>
                                                <option value="„ÄêNEWS„Äë ‚áí Hot Deals">„ÄêNEWS„Äë ‚áí Hot Deals</option>
                                                <option disabled>‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</option>
                                                <option value="„ÄêMEDIA„Äë ‚áí Screenshots">„ÄêMEDIA„Äë ‚áí Screenshots</option>
                                                <option value="„ÄêMEDIA„Äë ‚áí Illustration">„ÄêMEDIA„Äë ‚áí Illustration</option>
                                                <option value="„ÄêMEDIA„Äë ‚áí Anniversaries">„ÄêMEDIA„Äë ‚áí Anniversaries</option>
                                                <option disabled>‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</option>
                                                <option value="„ÄêARTICLE„Äë ‚áí Reviews">„ÄêARTICLE„Äë ‚áí Reviews</option>
                                                <option value="„ÄêARTICLE„Äë ‚áí Tips and Tricks">„ÄêARTICLE„Äë ‚áí Tips and Tricks</option>
                                                <option value="„ÄêARTICLE„Äë ‚áí Visual Novel 101">„ÄêARTICLE„Äë ‚áí Visual Novel 101</option>
                                                <option value="„ÄêARTICLE„Äë ‚áí Terminology">„ÄêARTICLE„Äë ‚áí Terminology</option>
                                                <option value="„ÄêARTICLE„Äë ‚áí Features">„ÄêARTICLE„Äë ‚áí Features</option>
                                            </select>
                                        </div>
                                    </div>
                                    <button class="btn btn-sm btn-primary insert-snippet"
                                        data-snippet-select="greetingSelect"
                                        data-snippet="Hello World!\n\n">
                                        Insert
                                    </button>
                                </div>

                                <div class="list-group-item d-flex justify-content-between align-items-start flex-wrap gap-2">
                                    <div>
                                        <div class="fw-semibold">Hyperlink</div>
                                        <div class="d-flex align-items-center gap-2 mt-2 flex-wrap">
                                            <select id="storyHookSelect" class="form-select form-select-sm w-auto">
                                                <option value="üîó Website ‚ãÆ ">Website</option>
                                                <option value="üîó X (Twitter) ‚ãÆ ">X (Twitter)</option>
                                                <option value="üîó Youtube ‚ãÆ ">Youtube</option>
                                                <option value="üîó Steam ‚ãÆ ">Steam</option>
                                            </select>
                                        </div>
                                    </div>
                                    <button class="btn btn-sm btn-primary insert-snippet"
                                        data-snippet-select="storyHookSelect"
                                        data-snippet="Chapter Update:\n- Title: [Enter title]\n- Summary: [Add summary here]\n\n">
                                        Insert
                                    </button>
                                </div>

                                <div class="list-group-item d-flex justify-content-between align-items-start flex-wrap gap-2">
                                    <div>
                                        <div class="fw-semibold">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏°</div>
                                    </div>
                                    <button class="btn btn-sm btn-primary insert-snippet"
                                        data-snippet="‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó 
‚ÑπÔ∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏°
Developer ‚ãÆ 
Publisher ‚ãÆ 
Release Date ‚ãÆ 
Language ‚ãÆ English, Japanese
Version ‚ãÆ Censored Edition*
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù 
">
                                        Insert
                                    </button>
                                </div>

                                <div class="list-group-item d-flex justify-content-between align-items-start flex-wrap gap-2">
                                    <div>
                                        <div class="fw-semibold">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</div>
                                    </div>
                                    <button class="btn btn-sm btn-primary insert-snippet"
                                        data-snippet="‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
* ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ ‚ãÆ ">
                                        Insert
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Editor Column -->
                <div class="col-lg-8 col-xl-9">
                    <div class="card h-100">
                        <div class="card-header d-flex justify-content-between align-items-center flex-wrap gap-2">
                            <div>
                                <h3 class="card-title mb-1">Post Draft</h3>
                            </div>
                            <div class="d-flex gap-2">
                                <button class="btn btn-outline-danger btn-sm" id="clearEditorBtn">
                                    <i class="fas fa-trash me-2"></i>Clear Editor
                                </button>
                                <button class="btn btn-outline-secondary btn-sm" id="copyEditorBtn">
                                    <i class="fas fa-copy me-2"></i>Copy Draft
                                </button>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <textarea id="visualNovelEditor" class="form-control border-0 rounded-0" spellcheck="false"
                                placeholder="Start writing or use the snippets on the left..."
                                style="min-height: 70vh; resize: vertical; font-size: 1.1rem;"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <%- include('../partials/footer') %>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const editor = document.getElementById('visualNovelEditor');
            const snippetButtons = document.querySelectorAll('.insert-snippet');
            const clearBtn = document.getElementById('clearEditorBtn');
            const copyBtn = document.getElementById('copyEditorBtn');

            const insertAtCursor = (text) => {
                const start = editor.selectionStart ?? editor.value.length;
                const end = editor.selectionEnd ?? editor.value.length;
                const before = editor.value.substring(0, start);
                const after = editor.value.substring(end);
                editor.value = `${before}${text}${after}`;
                const cursorPosition = start + text.length;
                editor.selectionStart = cursorPosition;
                editor.selectionEnd = cursorPosition;
                editor.focus();
            };

            snippetButtons.forEach((btn) => {
                btn.addEventListener('click', () => {
                    const selectId = btn.dataset.snippetSelect;
                    let snippet = btn.dataset.snippet || '';

                    if (selectId) {
                        const selectEl = document.getElementById(selectId);
                        if (selectEl) {
                            snippet = selectEl.value || snippet;
                        }
                    }

                    insertAtCursor(snippet);
                });
            });

            clearBtn.addEventListener('click', () => {
                if (confirm('Clear the entire editor content?')) {
                    editor.value = '';
                    editor.focus();
                }
            });

            const showCopyFeedback = (success) => {
                if (!copyBtn) return;
                const originalHtml = copyBtn.dataset.originalHtml ?? copyBtn.innerHTML;
                copyBtn.dataset.originalHtml = originalHtml;
                copyBtn.disabled = true;
                copyBtn.innerHTML = success
                    ? '<i class="fas fa-check me-2"></i>Copied!'
                    : '<i class="fas fa-exclamation-triangle me-2"></i>Copy failed';
                setTimeout(() => {
                    copyBtn.innerHTML = copyBtn.dataset.originalHtml;
                    copyBtn.disabled = false;
                }, 2000);
            };

            const fallbackCopy = (text) => {
                const tempTextarea = document.createElement('textarea');
                tempTextarea.value = text;
                tempTextarea.style.position = 'fixed';
                tempTextarea.style.top = '-9999px';
                document.body.appendChild(tempTextarea);
                tempTextarea.focus();
                tempTextarea.select();
                let successful = false;
                try {
                    successful = document.execCommand('copy');
                } catch (err) {
                    successful = false;
                }
                document.body.removeChild(tempTextarea);
                return successful;
            };

            copyBtn?.addEventListener('click', async () => {
                const text = editor.value;
                if (!text) {
                    showCopyFeedback(true);
                    return;
                }

                try {
                    if (navigator.clipboard?.writeText) {
                        await navigator.clipboard.writeText(text);
                        showCopyFeedback(true);
                    } else {
                        const fallbackSuccess = fallbackCopy(text);
                        showCopyFeedback(fallbackSuccess);
                    }
                } catch (err) {
                    const fallbackSuccess = fallbackCopy(text);
                    showCopyFeedback(fallbackSuccess);
                }
            });
        });
    </script>
</body>