<%- include('../partials/head', { title: "Kagami Visual Novel Post Generator", cssFile: "visualnovel" }) %>
<body>
    <%- include('../partials/navbar_visualnovel') %>

    <div class="page-wrapper flex-grow-1" style="padding-top: 2rem;">
        <div class="container-xl">
            <div class="row g-4">
                <!-- Snippet Library Column -->
                <div class="col-lg-4 col-xl-3">
                    <div class="card h-100">
                        <div class="card-header">
                            <h3 class="card-title mb-1">Snippet Library</h3>
                            <p class="card-subtitle text-muted mb-0">Click insert to add templates into the editor.</p>
                        </div>
                        <div class="card-body p-0">
                            <div class="list-group list-group-flush">
                                <div class="list-group-item d-flex justify-content-between align-items-start flex-wrap gap-2">
                                    <div>
                                        <div class="fw-semibold">Hello</div>
                                        <small class="text-muted">Quick greeting opener</small>
                                        <div class="d-flex align-items-center gap-2 mt-2 flex-wrap">
                                            <label for="greetingSelect" class="form-label mb-0 small text-muted">Greeting</label>
                                            <select id="greetingSelect" class="form-select form-select-sm w-auto">
                                                <option value="Hello World!\n\n">Hello</option>
                                                <option value="Good morning, everyone!\n\n">Good Morning</option>
                                                <option value="Good afternoon, team!\n\n">Good Afternoon</option>
                                                <option value="Good evening, friends!\n\n">Good Evening</option>
                                            </select>
                                        </div>
                                    </div>
                                    <button class="btn btn-sm btn-primary insert-snippet"
                                        data-snippet-select="greetingSelect"
                                        data-snippet="Hello World!\n\n">
                                        Insert
                                    </button>
                                </div>

                                <div class="list-group-item d-flex justify-content-between align-items-start flex-wrap gap-2">
                                    <div>
                                        <div class="fw-semibold">Story Hook</div>
                                        <small class="text-muted">Tease the latest chapter</small>
                                    </div>
                                    <button class="btn btn-sm btn-primary insert-snippet"
                                        data-snippet="Chapter Update:\n- Title: [Enter title]\n- Summary: [Add summary here]\n\n">
                                        Insert
                                    </button>
                                </div>

                                <div class="list-group-item d-flex justify-content-between align-items-start flex-wrap gap-2">
                                    <div>
                                        <div class="fw-semibold">Character Notes</div>
                                        <small class="text-muted">Highlight character moments</small>
                                    </div>
                                    <button class="btn btn-sm btn-primary insert-snippet"
                                        data-snippet="Character Spotlight:\nName: [Character]\nEmotion: [Feeling]\nScene Notes: [Details]\n\n">
                                        Insert
                                    </button>
                                </div>

                                <div class="list-group-item d-flex justify-content-between align-items-start flex-wrap gap-2">
                                    <div>
                                        <div class="fw-semibold">Call to Action</div>
                                        <small class="text-muted">Encourage readers to comment</small>
                                    </div>
                                    <button class="btn btn-sm btn-primary insert-snippet"
                                        data-snippet="What do you think happens next? Share your theories below!\n\n">
                                        Insert
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Editor Column -->
                <div class="col-lg-8 col-xl-9">
                    <div class="card h-100">
                        <div class="card-header d-flex justify-content-between align-items-center flex-wrap gap-2">
                            <div>
                                <h3 class="card-title mb-1">Post Draft</h3>
                                <p class="card-subtitle text-muted mb-0">Build your visual novel announcement or recap.</p>
                            </div>
                            <button class="btn btn-outline-danger btn-sm" id="clearEditorBtn">
                                <i class="fas fa-trash me-2"></i>Clear Editor
                            </button>
                        </div>
                        <div class="card-body">
                            <label for="visualNovelEditor" class="form-label fw-semibold">Content</label>
                            <textarea id="visualNovelEditor" class="form-control" spellcheck="false"
                                placeholder="Start writing or use the snippets on the left..."
                                style="min-height: 70vh; resize: vertical; font-size: 1.1rem;"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <%- include('../partials/footer') %>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const editor = document.getElementById('visualNovelEditor');
            const snippetButtons = document.querySelectorAll('.insert-snippet');
            const clearBtn = document.getElementById('clearEditorBtn');

            const insertAtCursor = (text) => {
                const start = editor.selectionStart ?? editor.value.length;
                const end = editor.selectionEnd ?? editor.value.length;
                const before = editor.value.substring(0, start);
                const after = editor.value.substring(end);
                editor.value = `${before}${text}${after}`;
                const cursorPosition = start + text.length;
                editor.selectionStart = cursorPosition;
                editor.selectionEnd = cursorPosition;
                editor.focus();
            };

            snippetButtons.forEach((btn) => {
                btn.addEventListener('click', () => {
                    const selectId = btn.dataset.snippetSelect;
                    let snippet = btn.dataset.snippet || '';

                    if (selectId) {
                        const selectEl = document.getElementById(selectId);
                        if (selectEl) {
                            snippet = selectEl.value || snippet;
                        }
                    }

                    insertAtCursor(snippet);
                });
            });

            clearBtn.addEventListener('click', () => {
                if (confirm('Clear the entire editor content?')) {
                    editor.value = '';
                    editor.focus();
                }
            });
        });
    </script>
</body>